<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>{{title}}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
        <style>
            table, td, th {
                border: 1px solid;
                padding: 3px;
            }
            th {
                text-align: center;
            }
            .num_cell {
                text-align: right;
            }
            .summary {
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="container">
        <h1> SkiPass Report </h1>
        <h2><a href="./diff/report/index.html"> Diff Report </a></h2>
        <p/>
        <h2> Malloc bytes allocated </h2>

        {% for benchmark in benchmarks %}
        <p/>
        <h4> TestCases: {{ benchmark['title'] }}</h4>
        <table>
            <tr>
                <th> Image </th>
            {% for opt in skp_membench_opts %}
                <th> {{skp_membench_opts[opt]['display_name']}} </th>
            {% endfor %}
            </tr>
            {% for skp in benchmark['skps'] if skp['NO_OPT']['bytes'] != '0' %}
            <tr>
                <td><a href="{{ skp['ref_img_url']}}"> {{ skp['display_name'] }} </a> <br/>
                </td>
                {% for opt in skp_membench_opts %}
                    <td class="num_cell"> 
                        <a href = "{{skp[opt]['log']}}">
                             {{skp[opt]['bytes']}} 
                        </a>
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
            <tr class="summary">
                <td> Summary </a> <br/>
                </td>
                {% for opt in skp_membench_opts %}
                    <td class="num_cell"> 
                        {{benchmark['summary'][opt]['bytes']}} 
                    </td>
                {% endfor %}
            </tr>
            
        </table>
        {% endfor %}
        <p/>

        <h2> Duration (nano seconds) </h2>

        {% for benchmark in benchmarks %}
        <p/>
        <h4> TestCases: {{ benchmark['title'] }}</h4>
        <table>
            <tr>
                <th> Image </th>
            {% for opt in skp_membench_opts %}
                <th> {{skp_membench_opts[opt]['display_name']}} </th>
            {% endfor %}
            <th> SkiPass (Inside Rust) </th>
            </tr>
            {% for skp in benchmark['skps'] %}
            <tr>
                <td><a href="{{ skp['ref_img_url']}}"> {{ skp['display_name'] }} </a> <br/>
                </td>
                {% for opt in skp_membench_opts %}
                    <td class="num_cell"> 
                        {{skp[opt]['duration']}} 
                    </td>
                {% endfor %}
                <td class = "num_cell">
                    {{skp['SKI_PASS']['inside_rust']}} 
                </td>
            </tr>
            {% endfor %}
            </tr>
            
        </table>
        {% endfor %}

        <h3> Duration (Ski Pass breakdown) </h3>

        {% for benchmark in benchmarks %}
        <p/>
        <h4> TestCases: {{ benchmark['title'] }}</h4>
        <table>
            <tr>
                <th colspan="2"> Image </th>
                <th> SkRecord to SkiLang </th>
                <th> EqSat SkiLang </th>
                <th> SkiLang to Instructions </th>
                <th> Outside Rust </th>
            </tr>
            {% for skp in benchmark['skps'] %}
            <tr>
                <td rowspan="2"><a href="{{ skp['ref_img_url']}}"> {{ skp['display_name'] }} </a> <br/></td>
                <td> Duration </td>
                <td class="num_cell"> {{skp['SKI_PASS']['sk_record_to_ski_lang_duration']}} </td>
                <td class="num_cell"> {{skp['SKI_PASS']['eqsat_duration']}} </td>
                <td class="num_cell"> {{skp['SKI_PASS']['ski_lang_to_instructions_duration_nano']}} </td>
                <td class="num_cell"> {{skp['SKI_PASS']['outside_rust']}} </td>
            </tr>
            <tr>
                <td> Percentage </td>
                <td class="num_cell"> {{"{:.2f}".format(skp['SKI_PASS']['sk_record_to_ski_lang_duration_%'])}} </td>
                <td class="num_cell"> {{"{:.2f}".format(skp['SKI_PASS']['eqsat_duration_%'])}} </td>
                <td class="num_cell"> {{"{:.2f}".format(skp['SKI_PASS']['ski_lang_to_instructions_duration_nano_%'])}} </td>
                <td class="num_cell"> {{"{:.2f}".format(skp['SKI_PASS']['outside_rust_%'])}} </td>
            </tr>
            {% endfor %}
            </tr>
            
        </table>
        {% endfor %}
        <p/>


        <h1> Debug stuff </h1>

        <h2> Images and SKPs </h2>
        Download and open the SKP in <a href="http://debugger.skia.org"> debugger.skia.org </a>

        {% for benchmark in benchmarks %}
        <h4> TestCases: {{ benchmark['title'] }}</h4>
        <table>
            <tr>
                <th> TestCase </th>
            {% for opt in skp_membench_opts %}
                <th> {{skp_membench_opts[opt]['display_name']}} </th>
            {% endfor %}
            </tr>
            {% for skp in benchmark['skps'] %}
                <tr>
                <td rowspan="2"><a href="{{ skp['ref_img_url']}}"> {{ skp['display_name'] }} </a> <br/>
                </td>
                {% for opt in skp_membench_opts %}
                    <td> 
                        <a href = "{{skp[opt]['skp']}}">
                            SKP
                        </a>
                    </td>
                {% endfor %}
                </tr>
                <tr>
                {% for opt in skp_membench_opts %}
                    <td> 
                        <a href = "{{skp[opt]['img']}}">
                            IMG
                        </a>
                    </td>
                {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <p/>
        {% endfor %}

        <p/>
        </div>
    </body>
</html>

